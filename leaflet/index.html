<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <title>Snipes Farm - Points of Interest</title>
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
    integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
    crossorigin=""></script>
    <script src="leaflet-rotate-master/dist/leaflet-rotate-src.js"></script>
    <style>
        #map { height: 750px; }
    </style>
  </head>
  <body>
    <div><h1>Snipes Farm & Recreation Center - Points of Interest</h1></div>
    <div id='map'></div>
    <script>
        var map = L.map('map',{

            zoomControl:false,
            doubleClickZoom:false,
            dragging:false,
            boxZoom:false,
            scrollWheelZoom:false,
            zoomSnap:0,
            rotate:true,
            bearing: -30

        }).setView([40.199244, -74.796412], 18.9);


        // L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        //     maxZoom: 20,
        //     attribution: 'Â© OpenStreetMap'
        // }).addTo(map);

        var ratio = 1.458563535911602
        var imageUrl = 'backgroundMap.png'
        imageBounds = [[40.197903, -74.79843], [40.20061655, -74.7943]];
        L.imageOverlay(imageUrl, imageBounds).addTo(map);
       
        // function onMapClick(e) {
        //     alert("You clicked the map at " + e.latlng);
        // }

        // map.on('click', onMapClick);
        
        // var data = [
                // {

                //     'properties': {
                //         'title': 'Offfice',
                //         'description':
                //             'This is where the bees make Honey!',
                //         'imageLink':'https://ourdailyhomestead.com/wp-content/uploads/2020/06/how-to-start-a-beehive-with-wild-bees-1024x683.jpg'
                //     },
                //     'geometry': {
                //         'coordinates': [40.198795, -74.796495]
                //     }
                // },
        //         {
        //             'properties': {
        //                 'title': 'Big Red Barn',
        //                 'imageLink': '',
        //                 'description':
        //                     '<strong>Mad Men Season Five Finale Watch Party</strong><p>Head to Lounge 201 (201 Massachusetts Avenue NE) Sunday for a Mad Men Season Five Finale Watch Party, complete with 60s costume contest, Mad Men trivia, and retro food and drink. 8:00-11:00 p.m. $10 general admission, $20 admission and two hour open bar.</p>'
        //             },
        //             'geometry': {
        //                 'coordinates': [40.199353, -74.797513]
        //             }
        //         }
        //     ]
  

        

        //function getLocationData(){
            var apiUrl = 'https://script.google.com/macros/s/AKfycbzek3Z1iuBYBzWG9aigJBAqJblw8KmC1hjxi2w0mjV8oHzpykJnLix-MXMcUUCqZ3_YQA/exec'
            fetch(apiUrl)
            .then(response => {
                // indicates whether the response is successful (status code 200-299) or not
                if (!response.ok) {
                throw new Error(`Request failed with status ${reponse.status}`)
                }
                return response.json()
            })
            .then(resData => {
                console.log(resData)
                var data=[]
                for(var i =1;i<resData.length;i++){
                    data.push({
                    'properties': {
                        'title': resData[i][0],
                        'description':
                        resData[i][1],
                        iconSize:resData[i][4],
                        'imageLink':resData[i][5],
                        moreInfoText:resData[i][6],
                        moreInfoUrl:resData[i][7]
                    },
                    'geometry': {
                        'coordinates': [resData[i][2], resData[i][3]]
                    }
                    })
                }
                return data

            }).then(data=>{
                for (var i=0;i<data.length;i++){
                    var iconSize = [60,60]
                    if(data[i].properties.iconSize == 'small'){
                        iconSize = [40,40]
                    } else if (data[i].properties.iconSize == 'large'){
                        iconSize = [100,100]
                    }
            
            var icon = L.icon({
                iconUrl: 'clear.png',
                iconSize,
            //  iconAnchor: [22, 94],
                popupAnchor: [0, -25],
                
                // shadowUrl: 'my-icon-shadow.png',
                // shadowSize: [68, 95],
                // shadowAnchor: [22, 94]
            });
            var coords = data[i].geometry.coordinates
            var marker = L.marker([ coords[0],coords[1]],{
                icon
            }).addTo(map);

            const title = `<h3>${data[i].properties.title}</h3>`;
            var image = ''
            if(data[i].properties.imageLink.length>0){
                image = `<div style='text-align:center'><img width=150 src='${data[i].properties.imageLink}'></img><div>`
            }
            const description = `<p>${data[i].properties.description}</p>`;
            var html = title+image+description

            marker.bindPopup(html)
        }
            })
            .catch(error => console.log(error))

        

        
        
        
 </script>
        
  </body>
</html>
